# Выбор и настройка мониторинга в системе

## Мониторинг

Мониторинг позволит узнавать о неполадках до того, как они станут известны пользователям. Это позволит повысить надежность системы, что в свою очередь позволит не терять заказы. 

Если из-за нестабильности и медленной работы от взаимодействия с системой отказываются и пользователи и сторонние бизнесы, точно имеет смысл на это повлиять.

## Выбор подхода к мониторингу

Подход Четыре золотых сигнала кажется мне наиболее подходящим. Он позволяет покрыть как случаи частых запросов, закрузку больших файлов по сети, задержку сообщений в очередях. 

Подход на все подсистемы планирую оставить один, для унификации.

## Набор метрик

Метрики для отслеживания состояния RabbitMQ:
- Number of dead-letter-exchange letters in RabbitMQ
- Number of messages in flight in RabbitMQ

Метрики для понимания количества запросов к разным сервисам (могут помочь в случае вредоносных атак):
- Number of requests (RPS) for internet shop API
- Number of requests (RPS) for CRM API
- Number of requests (RPS) for MES API
- Number of requests (RPS) per user for internet shop API
- Number of requests (RPS) per user for CRM API
- Number of requests (RPS) per user for MES API

Базовая метрика для систем (поможет следить, чтобы серверы получали оптимальную нагрузку):
- CPU % for shop API
- CPU % for CRM API
- CPU % for MES API

Метрики для мониторинга потребления памяти (можно ввести и отказаться от них позже, если в потреблении памяти у системы нет аномалий):
- Memory Utilisation for shop API
- Memory Utilisation for CRM API
- Memory Utilisation for MES API
- Memory Utilisation for shop db instance
- Memory Utilisation for MES db instance

Количество подключений к БД (необходимо мониторить для оптимизации нагрузки на БД):
- Number of connections for shop db instance
- Number of connections for MES db instance

Скорость ответа (просто нужно):
- Response time (latency) for shop API
- Response time (latency) for CRM API
- Response time (latency) for MES API

Мониторинг хранилища (системы работают с большими файлами - легко может возникнуть проблема с хранилищем):
- Size of S3 storage
- Size of shop db instance
- Size of MES db instance

Метрики для понимания количества ошибок:
- Number of HTTP 200 for shop API
- Number of HTTP 200 for CRM API
- Number of HTTP 200 for MES API
- Number of HTTP 500 for shop API
- Number of HTTP 500 for CRM API
- Number of HTTP 500 for MES API

Метрики для оценки состояния сети:
- Kb transferred (received) for shop API
- Kb transferred (received) for CRM API
- Kb transferred (received) for MES API
- Kb provided (sent) for shop API
- Kb provided (sent) for CRM API
- Kb provided (sent) for MES API

## План действий

- Поднять инстанс Prometheus для хранения метрик
- Настроить сбор всех необходимых метрик с систем.
- Поднять инстанс grafana 
- Настроить вывод метрик на графики, настроить алерты, сделать регламенты для всех метрик